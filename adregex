#!/bin/bash
############################
# Telegram å»å¹¿å‘Šæ­£åˆ™ç”Ÿæˆè„šæœ¬ https://github.com/AzurLab/Tg-Ad-RegEx
# ä¸€é”®å‘½ä»¤ wget https://raw.githubusercontent.com/AzurLab/Tg-Ad-RegEx/main/adregex -O adregex && chmod +x adregex && ./adregex
##############################
# å¯è‡ªå®šä¹‰å…³é”®è¯
# ${b_keyword1} ${b_keyword2} ${b_keyword2p} ${s_keyword} ${file_suffix} ${nickname}
##############################
# åŒå…³é”®è¯è§„åˆ™ ä¸¤ä¸ªå…³é”®è¯åŒæ—¶å‡ºç°ç”Ÿæ•ˆ

# åŒå…³é”®è¯1 ä»¥å•†å“åä¸ºä¸»

b_keyword1='å¹¿å‘Š|ä¸šåŠ¡|æœåŠ¡å™¨|cdn|é˜¿é‡Œäº‘|è…¾è®¯äº‘|é«˜é˜²|vps|ç‹¬æœ|æœç”«|å¹³å°|æ­å»º|å®šåˆ¶|æ¨å¹¿|å¼•æµ|æ‹‰[äººç¾¤è£™]|[ç¾¤è£™]å‘|[å¸å¢åŠ ]ç²‰|å…³æ³¨|ç‚¹èµ|è¯„è®º|æ°´å†›|æ´»è·ƒ|(wz|åƒµå°¸)ç²‰|(æ‰¹é‡å°|éå°|[ä¹°å–]|å¾®ä¿¡|QQ|é’‰é’‰|å…¬ä¼—|é™Œé™Œ|æ¢æ¢)å·|ä¼ä¸šå¾®ä¿¡|ç”µ[å•†é”€]|è‚¡æ°‘|å°ç¾¤|åšå½©|è èœ|äºšåš|æ£‹ç‰Œ|bc|ç‹—æ¨|äººäº‹|å…¼èŒ|æ‹›([äººè˜å‹Ÿ]|ä»£ç†)|æš—ç½‘|èµ„æº|æ•°æ®|[é»‘ç°]äº§|æ”¯ä»˜|ä»¶å¥—|(é»‘|é“¶è¡Œ|ä¿¡ç”¨)å¡|å¯¹å…¬|[è´¦å…¬ä¸ªç§]æˆ·|ä»£[æ”¶ä»˜å‘]|æ´—[é’±ç±³]|æ¼‚ç™½|èµ„é‡‘|è½¬è´¦|usdt|[å›æ”¶å‡º]u|å¥—ç°|æ¢æ±‡|è´·æ¬¾|ç½‘è´·|é€è´§|è·‘åˆ†|èµšé’±|å¡[å•†ç‹]|æŸ¥[è¯¢äººè½¦æˆ¿æˆ·æ¡£]|å®šä½|ç›‘å¬|äººé¬¼|å¼€æˆ¿|ç¤¾å·¥|(è‹¹æœ|iOS|ä¼ä¸š)ç­¾å|ç«ç§|è“æ ‡|æ³¨å†Œ|è†ç”°|æ‰‹è¡¨|é«˜ä»¿|æ°´é¬¼|ç§Ÿæˆ¿|æˆ¿æº|[ä¸€1][æ¯”å¯¹][ä¸€1]|[ä¸€äºŒä¸‰]æ‰‹'

# åŒå…³é”®è¯2 ä»¥å¯¹å•†å“çš„ä¿®é¥°ä¸ºä¸»

b_keyword2='ç”µæŠ¥|tg|telegram|å‡º|å”®|å–|æ”¶|è¯¦[æƒ…è¯¢]|é¢äº¤|éœ€è¦|å’¨è¯¢|åˆä½œ|[ç‚¹åŠ çœ‹æ‰¾]æˆ‘|ç‚¹å¤´åƒ|dd|æ»´æ»´|è”ç³»|ç§|[vè–‡]ä¿¡|[åŠ \+][vqè–‡]|çœŸ[äººå®]|å®å|è®¤è¯|ç­›é€‰|è§£å°|æ‹…ä¿|ä¸“[ä¸šä¾›]|ç²¾å‡†|å®åŠ›|é«˜ç«¯|ä¾›åº”|å¤§é‡|æ‰¹å‘|[ç°æœ‰][è´§ğŸ”¥]|è´§æº|ç›´å‡º|å®‰æ’|å…¨æ–°|åŸè£…|[ä¸€äºŒä¸‰]æ‰‹|ä¸ªäºº|å›¢é˜Ÿ|å·¥ä½œå®¤|æŠ¼é‡‘|ç‚¹ä½|[0-9]ç‚¹|é«˜ä»·|å…è´¹(æµ‹è¯•|è¯•ç”¨)|å‡ºæ°´|å…¨çƒ|æ¯æ—¥æ›´æ–°|å¡æ¥'

# åŒå…³é”®è¯2plus å•ç‹¬å‡ºç°æ—¶ï¼Œè¯¯æ€å¯èƒ½æ€§è¾ƒå¤§ï¼Œä¸ºäº†è‰¯å¥½çš„å¼•ç”¨æ€§ï¼Œå•ç‹¬åˆ—å‡º

b_keyword2p='è²|ä»™å¥³'

# å•å…³é”®è¯è§„åˆ™ æ¯æ¡ç›¸äº’ç‹¬ç«‹ç”Ÿæ•ˆ

s_keyword='^(dd|æ»´æ»´|ç­¾åˆ°)$|å°å“¥å“¥.*åœ¨(ä¸åœ¨|å—)|éœ€è¦.*è”ç³»|[vè–‡]ä¿¡|^åŠ v'

# æ–‡ä»¶åç¼€è§„åˆ™ åˆ é™¤å¯æ‰§è¡Œæ–‡ä»¶

file_suffix='exe|cmd|com|bat|scr|cpl|vbs'

# æ˜µç§°è§„åˆ™ é’ˆå¯¹æ˜µç§° ç”±äºå…¶ç‰¹æ®Šæ€§ï¼Œæš‚ä¸èƒ½åŒ…å«åœ¨åˆå¹¶è§„åˆ™ä¸­
# è‡ªåŠ¨åŒ…å«åŒå…³é”®è¯1å’Œ2ï¼Œä½†ä¸åŒ…å«2p
#
nickname='^(åœ¨?è²)|^(1+|å°?ä»™å¥³)$|å¤´åƒ|èµ„æ–™'

##############################
# ä»¥ä¸‹æ˜¯è„šæœ¬
##############################

# è¾“å‡ºè§„åˆ™
re_print(){
    #æ£€æŸ¥æ˜¯å¦å·²è¢«è¾“å‡º
    if [ "${re_printed[$1]}" != "1" ] ;then
        re_printed[$1]=1
        case "$1" in
           1)
                #æ–‡ä»¶
                echo -e "\033[7;96madregex: File Suffix Rule æ–‡ä»¶åç¼€è§„åˆ™\033[0m"
                echo "(?i:\.(${file_suffix})\$)===delete"
                ;;
           2)
                #å•
                echo -e "\033[7;96madregex: Independent Rule å•å…³é”®è¯è§„åˆ™\033[0m"
                echo "(?i:(${s_keyword}))===delete"
                ;;
           4)
                #åŒ
                echo -e "\033[7;96madregex: Joint Rule åŒå…³é”®è¯è§„åˆ™\033[0m"
                echo "(?i:(${b_keyword1}).*(${b_keyword2}|${b_keyword2p})|(${b_keyword2}|${b_keyword2p}).*(${b_keyword1}))===delete"
                ;;
           8)
                #æ˜µç§°
                echo -e "\033[7;96madregex: Nickname Rule æ˜µç§°è§„åˆ™\033[0m"
                echo "name:(${nickname}|${b_keyword1}|${b_keyword2})===delete"
                ;;
           0)
                #åˆå¹¶
                echo -e "\033[7;96madregex: All in One Rule åˆå¹¶è§„åˆ™\033[0m"
                echo "(?i:(${b_keyword1}).*(${b_keyword2}|${b_keyword2p})|(${b_keyword2}|${b_keyword2p}).*(${b_keyword1})|(${s_keyword})|\.(${file_suffix})\$)===delete"
                ;;
           *)
                #
                ;;
        esac
    fi

}

# è¾“å‡ºå¸®åŠ©
help_print(){
    echo "adregx: help\nè¾“å…¥ 1 è·å–æ–‡ä»¶åç¼€è§„åˆ™\nè¾“å…¥ 2 è·å–å•å…³é”®è¯è§„åˆ™\nè¾“å…¥ 4 è·å–åŒå…³é”®è¯è§„åˆ™\nè¾“å…¥ 8 è·å–æ˜µç§°è§„åˆ™\nè¾“å…¥ 0 æˆ–ä»€ä¹ˆéƒ½ä¸è¾“å…¥ è·å–åˆå¹¶è§„åˆ™å’Œæ˜µç§°è§„åˆ™\nåŒæ—¶è·å–å¤šæ¡è§„åˆ™ï¼Œè¯·å°†ä»¥ä¸Šå‚æ•°ç›¸åŠ æˆ–è€…ä½¿ç”¨ç©ºæ ¼éš”å¼€"
}

# è¾“å‡ºé”™è¯¯
err_print(){
    echo -e "\033[1;91;103madregex: invalid parameter value '$1'\033[0m"
    help_print
}

# è¾“å‡ºå†è§
goodbye_print(){
    echo -e "\033[7;92madregex: å·²ä¸ºæ‚¨ç”Ÿæˆ ${#re_printed[@]} æ¡è§„åˆ™ï¼Œæ„Ÿè°¢ä½¿ç”¨\033[0m"
}


# è¯»å–ï¼Œåˆ‡å‰²å‚æ•°
parameter_read(){
    #åˆå§‹åŒ–è¾“å‡ºè®°å½•
    re_printed=()
    #æ— å‚æ•°ï¼Œè¾“å‡ºé»˜è®¤
    if [ $# -eq 0 ] ;then re_print 0; re_print 8; fi
    #ä¾æ¬¡è¯»å–å‚æ•°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦å…¨éƒ¨è¾“å‡ºè¿‡
    while [ "${#re_printed[@]}" -lt 5 ] && [[ $# -ge 1 ]] ;do
        key="$1"
        case $key in
            0) re_print 0; re_print 8;;
            [1-9]) ;& [1-9][0-9])
                factor=16 # 2^4
                if [ "$key" -ge "$factor" ]; then
                    error="true"
                    break
                else
                    while [ "$factor" -gt 1 ]; do
                        factor=$((factor/2))
                        while [ "$key" -ge "$factor" ] ;do
                            let key-=$factor
                            re_print $factor
                        done
                    done
                fi
                ;;
            *help*)
                help_print
                break
                ;;
            *)
                error="true"
                break
                ;;
        esac
        shift
    done
}

# è¯»å–ä¼ å…¥çš„å…¨éƒ¨å‚æ•°
parameter_read $@

# å‚æ•°å‡ºé”™æ—¶ï¼Œè¯·æ±‚é‡æ–°è¾“å…¥å‚æ•°
while [ "$error" == "true" ]; do
    err_print $key
    error="false"
    echo -n "è¯·é‡æ–°è¾“å…¥å‚æ•°ï¼Œæˆ–è¾“å…¥exité€€å‡ºï¼š"
    if read -t 60; then
        if [ "$REPLY" == "exit" ]; then
            exit 0
        else
            parameter_read $REPLY
        fi
    else
        echo "è¾“å…¥è¶…æ—¶æˆ–è¢«å–æ¶ˆï¼Œè¾“å‡ºé»˜è®¤è§„åˆ™"
        parameter_read
    fi
done

goodbye_print
